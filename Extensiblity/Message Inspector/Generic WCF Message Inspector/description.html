<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/a7bd86db-8a7a-43ce-8954-21f8f839f51bCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Generic WCF Message Inspector</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Generic WCF Message Inspector</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            WCF
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Architecture and Design, WCF Extensibility, Messaging
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Web
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">1/24/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Generic-WCF-Message-bdf4fb1f">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p><em>By default WCF Provides a good mechanism to handle messages during request and response scenarios. But to do this we need to create BehaviourExtension and Implement&nbsp;
</em>IDispatchMessageInspector <em>For each of such situation. For a scenario where you need to Audit / Log and Do Some tasks before it reaches to operation we have to implement in BehaviourExtensions along with Message Inspector. This sample provides a unified
 way to attach all Inspectors that are indepdently created for a specific task and assigned to an End Point.</em></p>
<h1><span>Building the Sample</span></h1>
<p><em>The sample is created with VS2010 and WCF 4. Just compile and run the service first followed by client.<br>
</em></p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p>This sample provides a unified model to attach Message Inspectors without having to create WCF Classes for each implementation. And these inspectors will be invoked in an order that are specified in the config file. You just need to attach one behvaiour
 and that WCF Behaviour will take care of arranging / order and invoke all the custom inspectors.</p>
<p>Below configuration shows how to register the custom inspectors. The sample service has registered three custom inspectors.</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>XML</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">xml</span>
<pre class="hidden">&lt;configSections&gt;
    &lt;section name=&quot;MessageInterceptorRegistrationConfiguration&quot; type=&quot;SampleGenericWcfMessageInterceptor.Configuration.GenericMessageInterceptorRegistration, SampleGenericWcfMessageInterceptor&quot;/&gt;
  &lt;/configSections&gt;
  &lt;appSettings/&gt;
  &lt;MessageInterceptorRegistrationConfiguration&gt;
    &lt;GenericMessageInterceptorConfigurationElements&gt;
      &lt;GenericMessageInterceptorConfigurationElement MessageInterceptorEndPointName=&quot;myEndPoint1&quot; MessageInterceptorIndex=&quot;1&quot; MessageInterceptorAssembly=&quot;SampleWCFService&quot; MessageInterceptor=&quot;SampleWCFService.InterceptorHandlers.Authentication&quot;/&gt;
      &lt;GenericMessageInterceptorConfigurationElement MessageInterceptorEndPointName=&quot;myEndPoint1&quot; MessageInterceptorIndex=&quot;2&quot; MessageInterceptorAssembly=&quot;SampleWCFService&quot; MessageInterceptor=&quot;SampleWCFService.InterceptorHandlers.Audit&quot;/&gt;
      &lt;GenericMessageInterceptorConfigurationElement MessageInterceptorEndPointName=&quot;myEndPoint1&quot; MessageInterceptorIndex=&quot;3&quot; MessageInterceptorAssembly=&quot;SampleWCFService&quot; MessageInterceptor=&quot;SampleWCFService.InterceptorHandlers.Log&quot;/&gt;
    &lt;/GenericMessageInterceptorConfigurationElements&gt;
  &lt;/MessageInterceptorRegistrationConfiguration&gt;</pre>
<div class="preview">
<pre id="codePreview" class="csharp">&lt;configSections&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;section&nbsp;name=<span class="cs__string">&quot;MessageInterceptorRegistrationConfiguration&quot;</span>&nbsp;type=<span class="cs__string">&quot;SampleGenericWcfMessageInterceptor.Configuration.GenericMessageInterceptorRegistration,&nbsp;SampleGenericWcfMessageInterceptor&quot;</span>/&gt;&nbsp;
&nbsp;&nbsp;&lt;/configSections&gt;&nbsp;
&nbsp;&nbsp;&lt;appSettings/&gt;&nbsp;
&nbsp;&nbsp;&lt;MessageInterceptorRegistrationConfiguration&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;GenericMessageInterceptorConfigurationElements&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GenericMessageInterceptorConfigurationElement&nbsp;MessageInterceptorEndPointName=<span class="cs__string">&quot;myEndPoint1&quot;</span>&nbsp;MessageInterceptorIndex=<span class="cs__string">&quot;1&quot;</span>&nbsp;MessageInterceptorAssembly=<span class="cs__string">&quot;SampleWCFService&quot;</span>&nbsp;MessageInterceptor=<span class="cs__string">&quot;SampleWCFService.InterceptorHandlers.Authentication&quot;</span>/&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GenericMessageInterceptorConfigurationElement&nbsp;MessageInterceptorEndPointName=<span class="cs__string">&quot;myEndPoint1&quot;</span>&nbsp;MessageInterceptorIndex=<span class="cs__string">&quot;2&quot;</span>&nbsp;MessageInterceptorAssembly=<span class="cs__string">&quot;SampleWCFService&quot;</span>&nbsp;MessageInterceptor=<span class="cs__string">&quot;SampleWCFService.InterceptorHandlers.Audit&quot;</span>/&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GenericMessageInterceptorConfigurationElement&nbsp;MessageInterceptorEndPointName=<span class="cs__string">&quot;myEndPoint1&quot;</span>&nbsp;MessageInterceptorIndex=<span class="cs__string">&quot;3&quot;</span>&nbsp;MessageInterceptorAssembly=<span class="cs__string">&quot;SampleWCFService&quot;</span>&nbsp;MessageInterceptor=<span class="cs__string">&quot;SampleWCFService.InterceptorHandlers.Log&quot;</span>/&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/GenericMessageInterceptorConfigurationElements&gt;&nbsp;
&nbsp;&nbsp;&lt;/MessageInterceptorRegistrationConfiguration&gt;</pre>
</div>
</div>
</div>
<h1><img src="description/Untitled.png" alt="" width="582" height="150"></h1>
<p>&nbsp;</p>
<p>The actual WCF Behaviour which is configured will invoke these individual Inspectors in the order that are registered for the endpoint.</p>
<p>&nbsp;</p>
<p>To use this custom Message Inspector below WCF Configuration is required.</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>XML</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">xml</span>
<pre class="hidden">&lt;system.serviceModel&gt;
&lt;extensions&gt;
      &lt;behaviorExtensions&gt;
        &lt;add name=&quot;GenericMessageInterceptorExtension&quot; type=&quot;SampleGenericWcfMessageInterceptor.Configuration.GenericMessageInterceptorBehaviorSection, SampleGenericWcfMessageInterceptor, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&quot;/&gt;
      &lt;/behaviorExtensions&gt;
    &lt;/extensions&gt;
    &lt;behaviors&gt;
      &lt;endpointBehaviors&gt;
        &lt;behavior name=&quot;GenericInspectorBehavior&quot;&gt;
          &lt;GenericMessageInterceptorExtension/&gt;
        &lt;/behavior&gt;
      &lt;/endpointBehaviors&gt;
&lt;/behaviors&gt;</pre>
<div class="preview">
<pre id="codePreview" class="xml"><span class="xml__tag_start">&lt;system</span>.serviceModel<span class="xml__tag_start">&gt;&nbsp;
</span><span class="xml__tag_start">&lt;extensions</span><span class="xml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_start">&lt;behaviorExtensions</span><span class="xml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_start">&lt;add</span>&nbsp;<span class="xml__attr_name">name</span>=<span class="xml__attr_value">&quot;GenericMessageInterceptorExtension&quot;</span>&nbsp;<span class="xml__attr_name">type</span>=<span class="xml__attr_value">&quot;SampleGenericWcfMessageInterceptor.Configuration.GenericMessageInterceptorBehaviorSection,&nbsp;SampleGenericWcfMessageInterceptor,&nbsp;Version=1.0.0.0,&nbsp;Culture=neutral,&nbsp;PublicKeyToken=null&quot;</span><span class="xml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_end">&lt;/behaviorExtensions&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_end">&lt;/extensions&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_start">&lt;behaviors</span><span class="xml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_start">&lt;endpointBehaviors</span><span class="xml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_start">&lt;behavior</span>&nbsp;<span class="xml__attr_name">name</span>=<span class="xml__attr_value">&quot;GenericInspectorBehavior&quot;</span><span class="xml__tag_start">&gt;&nbsp;
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_start">&lt;GenericMessageInterceptorExtension</span><span class="xml__tag_start">/&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_end">&lt;/behavior&gt;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml__tag_end">&lt;/endpointBehaviors&gt;</span>&nbsp;
<span class="xml__tag_end">&lt;/behaviors&gt;</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>&nbsp;</p>
<h1><span>Source Code Files</span></h1>
<ul>
<li>SampleGenericWcfMessageInterceptor<em> - Actual Project Which Contains All the Code<br>
</em></li><li>SampleWCFService - Sample Service using the Generic Message Incepector </li><li>SampleWCFService\InterceptorHandlers\Audit.cs - Sample Audit Message Inspector
</li><li>SampleWCFService\InterceptorHandlers\Authentication.cs - Sample Authentication Message Inspector
</li><li>SampleWCFService\InterceptorHandlers\Log.cs - Sample Log Message Inspector </li></ul>
<h1>More Information</h1>
<p>http://msdn.microsoft.com/en-us/library/system.servicemodel.dispatcher.idispatchmessageinspector.aspx</p>

</div>


    </div>
</body>
</html>
